<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <!-- 上一条代码IE=edge告诉IE使用最新的引擎渲染网页，chrome=1则可以激活Chrome Frame. -->
    <!-- https://blog.csdn.net/oJingZhiYuan12/article/details/88015130 -->
    <!-- 不过现在都什么年代了，IE我们就别考虑了吧，哈哈哈。 -->

    <title>SegJS</title>

    <link href="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <!-- <link href="css/style.css" rel="stylesheet" type="text/css"> -->
    <style type="text/css">
        body{background: #eee;}
        .bodywrap{min-height: 100vh;}
        .container.page{background: #fff;}
        .span-nav-desc{font-size: 0.6em;}
        .hidden{display: none;}
        /*#footer{padding-bottom: 5rem;}*/

        /*#box-editing{max-height: 80vh; overflow: auto;}*/

        .card-wrap{background: #fafafa; border: 1px solid #eee; margin: 1rem 0;}
        .btn_stc_wrap{margin: 0 0 1rem 0;}
        .textarea-editing,.xml-wrap{margin: 1rem 0;}
        .xml-area-wrap{background: #fff; /*border-bottom: 1px solid #eee;*/}
        .cxn-ctrol>.col>*{margin: 0.5rem 0; min-height: calc(1.5em + .5rem + 2px);}
        .cxn-ctrol.selected{background: #ff0}

        /*#page-ctrl{background: #fafafa;border: 1px solid #343a40; border-radius: 6px;}*/
        /*#page-ctrl>.container>.row>.col>*{margin: 0.25rem 0;}*/
        .outputbox{font-size: 10px;}
        #the-textarea{font-size: 10px;}
        #output .form-control{font-size: 10px;}
        #output textarea.wordlist{height: 80vh;}
        /*#chartpad svg{max-width: 800px;margin: 0 auto;}*/
    </style>


</head>

<body>

<div class="bodywrap">

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="#">SegJS</a><!-- 
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#the_navbar_toggler" aria-controls="the_navbar_toggler" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="the_navbar_toggler">
        </div> -->
    </nav>

    <div class="container my-5 page hiddent" id="page-text"><div class="container py-5">
        <div class="row">
            <div class="col">
                <div id="the-textarea-wrap">
                    <textarea class="form-control" id="the-textarea" rows="10">
1，2，3，3中文中文中国人哈哈哈哈哈这是什么啊，吃葡萄不吐葡萄皮，不吃葡萄倒吐葡萄皮。
                    </textarea>
<!--                     <textarea class="form-control" id="the-textarea" rows="10">
今年上半年，我在人人网实习了一段时间，期间得到了很多宝贵的数据，并做了一些还算有意义的事情，在这里和大家一块儿分享。感谢人人网提供的数据与工作环境，感谢赵继承博士、詹卫东老师的支持和建议。在这项工作中，我得到了很多与众人交流的机会，特别感谢 OpenParty 、 TEDxBeijing 提供的平台。本文已发表在了《程序员》杂志，分上下两部分刊于 2012 年 7 月刊和 8 月刊，在此感谢卢鸫翔编辑的辛勤工作。由于众所周知的原因，《程序员》刊出的文章被和谐过（看到后面大家就自动地知道被和谐的内容是什么了），因而我决定把完整版发在 Blog 上，同时与更多的人一同分享。对此感兴趣的朋友可以给我发邮件继续交流。好了，开始说正文吧。

作为中文系应用语言学专业的学生以及一名数学 Geek ，我非常热衷于用计算的方法去分析汉语资料。汉语是一种独特而神奇的语言。对汉语资料进行自然语言处理时，我们会遇到很多其他语言不会有的困难，比如分词——汉语的词与词之间没有空格，那计算机怎么才知道，“已结婚的和尚未结婚的青年都要实行计划生育”究竟说的是“已／结婚／的／和／尚未／结婚／的／青年”，还是“已／结婚／的／和尚／未／结婚／的／青年”呢？这就是所谓的分词歧义难题。不过，现在很多语言模型已经能比较漂亮地解决这一问题了。但在中文分词领域里，还有一个比分词歧义更令人头疼的东西——未登录词。中文没有首字母大写，专名号也被取消了，这叫计算机如何辨认人名地名之类的东西？更惨的则是机构名、品牌名、专业名词、缩略语、网络新词等等，它们的产生机制似乎完全无规律可寻。最近十年来，中文分词领域都在集中攻克这一难关。自动发现新词成为了关键的环节。
                    </textarea> -->
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <button type="button" name="do_statistics" id="do_statistics" class="btn btn-primary">统计</button>
            </div>
        </div>
    </div></div>

    <!-- <div class="container my-5 page hiddent" id="page-import"><div class="container py-2">
        <div class="row">
            <div class="col">
                <form name="file-form" class="container">
                    <div class="row" id="filePicker">
                        <label for="file-input" class="col-md-2 my-2 col-form-label text-md-right">选择文件：</label>
                        <div class="col-md-8 my-2">
                            <input type="file" class="form-control" name="file-input" id="file-input" name="file" multiple="multiple" accept=".xml" />
                        </div>
                        <div class="col-md-2 my-2">
                            <button type="button" name="do_import" id="do_import" class="btn btn-primary">导入</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div></div> -->

    <div class="container my-5 page hiddent" id="page-output"><div class="container py-5">
        <div class="row">
            <div class="col">
                <div id="output"></div>
            </div>
        </div>
    </div></div>

    <div class="container my-5 page hiddent" id="page-chartpad"><div class="container py-5">
        <div class="row">
            <div class="col">
                <div id="chartpad"></div>
            </div>
        </div>
    </div></div>

    <!-- <div class="container my-5 page hiddent" id="page-editing"><div class="container py-5"><div id="box-editing"><sentence-control v-for="S in Ss" :key="S.id" :S="S"></sentence-control>
    </div></div></div>

    <div class="container my-5 page hiddent" id="page-main"><div class="container py-5">
        <div class="row">
            <div class="col">
                <div id="xml"></div>
            </div>
        </div>
    </div></div> -->

</div>

<footer class="pt-4 pb-2 bg-dark text-white" id="footer">
    <div class="container text-center">
        <p>Github: <a href="https://github.com/gitforziio/SegJS" target="_blank">@gitforziio/SegJS</a></p>
    </div>
</footer>

    <script src="https://cdn.bootcss.com/vue/2.6.10/vue.min.js"></script>
    <!-- <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script> -->
    <!-- <script src="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script> -->
    <script src="https://cdn.bootcss.com/d3/5.12.0/d3.min.js"></script>
    <script src="https://cdn.bootcss.com/lodash.js/4.17.15/lodash.js"></script>

    <!-- <script src="lodash.js"></script> -->

    <script type="text/javascript" src="js/FileSaver.js"></script>
    <!-- <script type="text/javascript" src="js/seg.js"></script> -->
    <!-- <script type="text/javascript" src="js/main.js"></script> -->

    <script type="text/javascript" src="js/draw.js"></script>

    <script type="text/javascript">
        // "use strict";
        var the_text = '';
        var statistics_log;
        var data;
        var time_start;
        d3.select("#do_statistics").on('click',()=>{
            d3.select(`#the-textarea`).each(function(e, i) {the_text = this.value;});
            console.log(" ");

            if(typeof(myWorker)=="undefined") {
                myWorker = new Worker("js/seg.js");
            };

            myWorker.postMessage({txt:the_text, minwidth:1, maxwidth:6, expwin:4, dict:null});
            time_start = _.now();
            var the_text_len = the_text.replace(/([\n\r\s\t]+)/g,' ').trim().length;
            var msg1 = `文本长度：【${the_text_len}】；现在是【${time_start}】；开始统计，请耐心等待……`;
            console.log(msg1);
            d3.selectAll(`#output *`).remove();
            d3.select(`#output`).append("p").text(`${msg1}`);
            myWorker.onmessage = function (event) {
                if (event.data.stage=='result') {
                    var time_end = _.now();
                    // console.log(time_end);
                    console.log(`统计完毕！现在是【${time_end}】；共耗时：【${_.ceil((time_end-time_start)/1000,0)}】秒；均耗时：【${_.ceil(the_text_len/(time_end-time_start)*1000,2)}】字符/秒`);
                    data = event.data.data;
                    console.log(data);
                    var jjj = JSON.stringify(data);
                    var wD = _.cloneDeep(data.wordDict);
                    var jjjjj = _.forEach(wD,(d,i)=>{wD[i]=wD[i]['str']}).join('\n');
                    d3.selectAll(`#output *`).remove();
                    d3.select(`#output`).append("textarea").classed("form-control",true).attr("rows","10").text(jjj);
                    d3.select(`#output`).append("textarea").classed("form-control",true).classed("wordlist",true).text(jjjjj);
                    dottedChart(data.wordDict, "chartpad");
                    // myWorker.terminate();
                } else {
                    // d3.selectAll(`#output *`).remove();
                    console.log(`【stage: ${event.data.stage}】`);
                    d3.select(`#output`).append("p").text(`【当前阶段】：【${event.data.stage}】；请耐心等待……`);
                    data = event.data.data;
                    console.log(data);
                    // d3.select(`#output`).append("p").text(`【内容】：【${data}】`);
                }
            };
            myWorker.onerror = function (e) {
                console.log(`ERROR: Line ${e.lineno} in ${e.filename}: ${e.message}`);
            };
        });
    </script>

</body>

</html>
